import { NextRequest, NextResponse } from 'next/server';
import { connectDB } from '@/lib/mongodb';
import { AchievementDefinition } from '@/models/Achievement';

const defaultAchievements = [
  // æ•°é‡ç´¯ç§¯ç±»ï¼ˆæˆé•¿è„šå°ï¼‰
  {
    dimension: 'accumulation',
    category: 'task_count',
    level: 'bronze',
    name: 'åˆå‡ºèŒ…åº',
    description: 'ç´¯è®¡å®Œæˆ 10 ä¸ªä»»åŠ¡',
    icon: 'ğŸŒŸ',
    conditionType: 'total_tasks',
    requirement: 10,
    pointsReward: 50,
    honorPoints: 10,
    isHidden: false,
    isActive: true,
    order: 1,
  },
  {
    dimension: 'accumulation',
    category: 'task_count',
    level: 'silver',
    name: 'å°æœ‰æ‰€æˆ',
    description: 'ç´¯è®¡å®Œæˆ 50 ä¸ªä»»åŠ¡',
    icon: 'â­',
    conditionType: 'total_tasks',
    requirement: 50,
    pointsReward: 150,
    honorPoints: 30,
    isHidden: false,
    isActive: true,
    order: 2,
  },
  {
    dimension: 'accumulation',
    category: 'task_count',
    level: 'gold',
    name: 'é©¾è½»å°±ç†Ÿ',
    description: 'ç´¯è®¡å®Œæˆ 200 ä¸ªä»»åŠ¡',
    icon: 'ğŸŒ ',
    conditionType: 'total_tasks',
    requirement: 200,
    pointsReward: 500,
    honorPoints: 100,
    isHidden: false,
    isActive: true,
    order: 3,
  },
  {
    dimension: 'accumulation',
    category: 'task_count',
    level: 'legendary',
    name: 'Task Master',
    description: 'ç´¯è®¡å®Œæˆ 1000 ä¸ªä»»åŠ¡',
    icon: 'ğŸ‘‘',
    conditionType: 'total_tasks',
    requirement: 1000,
    pointsReward: 2000,
    honorPoints: 500,
    privileges: ['custom_task_icon'],
    isHidden: false,
    isActive: true,
    order: 4,
  },
  {
    dimension: 'accumulation',
    category: 'points_count',
    level: 'bronze',
    name: 'ç™¾æ­¥ç©¿æ¨',
    description: 'ç´¯è®¡è·å¾— 500 ç§¯åˆ†',
    icon: 'ğŸ¯',
    conditionType: 'total_points',
    requirement: 500,
    pointsReward: 100,
    honorPoints: 20,
    isHidden: false,
    isActive: true,
    order: 5,
  },
  {
    dimension: 'accumulation',
    category: 'points_count',
    level: 'silver',
    name: 'ç§¯åˆ†è¾¾äºº',
    description: 'ç´¯è®¡è·å¾— 2000 ç§¯åˆ†',
    icon: 'ğŸ’',
    conditionType: 'total_points',
    requirement: 2000,
    pointsReward: 300,
    honorPoints: 60,
    isHidden: false,
    isActive: true,
    order: 6,
  },
  {
    dimension: 'accumulation',
    category: 'points_count',
    level: 'gold',
    name: 'ç§¯åˆ†ä¼ å¥‡',
    description: 'ç´¯è®¡è·å¾— 10000 ç§¯åˆ†',
    icon: 'ğŸ†',
    conditionType: 'total_points',
    requirement: 10000,
    pointsReward: 1000,
    honorPoints: 200,
    isHidden: false,
    isActive: true,
    order: 7,
  },
  {
    dimension: 'accumulation',
    category: 'category_count',
    level: 'bronze',
    name: 'å®¶åŠ¡å°èƒ½æ‰‹',
    description: 'ç´¯è®¡å®Œæˆ 20 æ¬¡å®¶åŠ¡ç±»ä»»åŠ¡',
    icon: 'ğŸ§¹',
    conditionType: 'category_tasks',
    requirement: 20,
    requirementDetail: { category: 'housework' },
    pointsReward: 100,
    honorPoints: 20,
    isHidden: false,
    isActive: true,
    order: 8,
  },
  {
    dimension: 'accumulation',
    category: 'category_count',
    level: 'silver',
    name: 'å­¦ä¹ ä¹‹æ˜Ÿ',
    description: 'ç´¯è®¡å®Œæˆ 30 æ¬¡å­¦ä¹ ç±»ä»»åŠ¡',
    icon: 'ğŸ“š',
    conditionType: 'category_tasks',
    requirement: 30,
    requirementDetail: { category: 'learning' },
    pointsReward: 150,
    honorPoints: 30,
    isHidden: false,
    isActive: true,
    order: 9,
  },
  {
    dimension: 'accumulation',
    category: 'category_count',
    level: 'gold',
    name: 'ç”Ÿæ´»è¾¾äºº',
    description: 'ç´¯è®¡å®Œæˆ 100 æ¬¡ä¸ªäººå«ç”Ÿç±»ä»»åŠ¡',
    icon: 'âœ¨',
    conditionType: 'category_tasks',
    requirement: 100,
    requirementDetail: { category: 'personal_hygiene' },
    pointsReward: 300,
    honorPoints: 60,
    isHidden: false,
    isActive: true,
    order: 10,
  },

  // è¡Œä¸ºè¡¨ç°ç±»ï¼ˆå“è´¨å‹‹ç« ï¼‰
  {
    dimension: 'behavior',
    category: 'streak_behavior',
    level: 'bronze',
    name: 'è‡ªå¾‹è¾¾äºº',
    description: 'è¿ç»­ 7 å¤©åœ¨ 21:00 å‰å®Œæˆæ‰€æœ‰æ—¥å¸¸ä»»åŠ¡',
    icon: 'ğŸ“…',
    conditionType: 'consecutive_days',
    requirement: 7,
    pointsReward: 200,
    honorPoints: 50,
    isHidden: false,
    isActive: true,
    order: 11,
  },
  {
    dimension: 'behavior',
    category: 'streak_behavior',
    level: 'silver',
    name: 'åšæŒä¸æ‡ˆ',
    description: 'è¿ç»­ 21 å¤©å®Œæˆä»»åŠ¡',
    icon: 'ğŸ”¥',
    conditionType: 'consecutive_days',
    requirement: 21,
    pointsReward: 500,
    honorPoints: 100,
    isHidden: false,
    isActive: true,
    order: 12,
  },
  {
    dimension: 'behavior',
    category: 'streak_behavior',
    level: 'gold',
    name: 'ä¹ æƒ¯ä¹‹ç‹',
    description: 'è¿ç»­ 66 å¤©å®Œæˆä»»åŠ¡',
    icon: 'ğŸ‘‘',
    conditionType: 'consecutive_days',
    requirement: 66,
    pointsReward: 1500,
    honorPoints: 300,
    privileges: ['ultimate_wish'],
    isHidden: false,
    isActive: true,
    order: 13,
  },
  {
    dimension: 'behavior',
    category: 'time_behavior',
    level: 'bronze',
    name: 'æ™¨é—´å…ˆé”‹',
    description: 'è¿ç»­ 3 å¤©åœ¨ 8:00 å‰å®Œæˆâ€œåˆ·ç‰™/æ•´ç†åºŠé“ºâ€',
    icon: 'ğŸŒ…',
    conditionType: 'category_streak',
    requirement: 3,
    requirementDetail: { category: 'personal_hygiene' },
    pointsReward: 150,
    honorPoints: 30,
    isHidden: false,
    isActive: true,
    order: 14,
  },
  {
    dimension: 'behavior',
    category: 'time_behavior',
    level: 'silver',
    name: 'æ—©èµ·çš„é¸Ÿ',
    description: 'è¿ç»­ 14 å¤©åœ¨ 7:00 å‰å®Œæˆé¦–ä¸ªä»»åŠ¡',
    icon: 'ğŸ¦',
    conditionType: 'early_completion',
    requirement: 14,
    pointsReward: 400,
    honorPoints: 80,
    isHidden: false,
    isActive: true,
    order: 15,
  },
  {
    dimension: 'behavior',
    category: 'quality_behavior',
    level: 'bronze',
    name: 'å…¨èƒ½æˆ˜å£«',
    description: 'åŒæ—¶å¼€å¯å¹¶å®Œæˆäº† 3 ä¸ªä¸åŒç±»åˆ«çš„è‡ªå®šä¹‰ä»»åŠ¡',
    icon: 'âš”ï¸',
    conditionType: 'multi_category',
    requirement: 3,
    pointsReward: 200,
    honorPoints: 40,
    isHidden: false,
    isActive: true,
    order: 16,
  },
  {
    dimension: 'behavior',
    category: 'quality_behavior',
    level: 'gold',
    name: 'è¶…çº§å…¨èƒ½',
    description: 'åŒæ—¶å¼€å¯å¹¶å®Œæˆäº† 5 ä¸ªä¸åŒç±»åˆ«çš„ä»»åŠ¡',
    icon: 'ğŸ¦¸',
    conditionType: 'multi_category',
    requirement: 5,
    pointsReward: 600,
    honorPoints: 120,
    isHidden: false,
    isActive: true,
    order: 17,
  },

  // æƒŠå–œéšè—ç±»ï¼ˆå½©è›‹æˆå°±ï¼‰
  {
    dimension: 'surprise',
    category: 'hidden_surprise',
    level: 'bronze',
    name: 'çŸ¥é”™å°±æ”¹',
    description: 'ä»»åŠ¡è¢«å®¶é•¿æ‰“å›é‡åšåï¼Œåœ¨ 30 åˆ†é’Ÿå†…å†æ¬¡æäº¤å¹¶å®¡æ ¸é€šè¿‡',
    icon: 'ğŸ”„',
    conditionType: 'resubmit_quick',
    requirement: 1,
    pointsReward: 100,
    honorPoints: 25,
    isHidden: true,
    order: 18,
  },
  {
    dimension: 'surprise',
    category: 'hidden_surprise',
    level: 'silver',
    name: 'å¿«é€Ÿä¿®æ­£',
    description: '5 æ¬¡åœ¨ 30 åˆ†é’Ÿå†…å¿«é€Ÿä¿®æ­£ä»»åŠ¡',
    icon: 'âš¡',
    conditionType: 'resubmit_quick',
    requirement: 5,
    pointsReward: 300,
    honorPoints: 60,
    isHidden: true,
    order: 19,
  },
  {
    dimension: 'surprise',
    category: 'hidden_surprise',
    level: 'gold',
    name: 'æ„å¤–æƒŠå–œ',
    description: 'åœ¨ç”Ÿæ—¥å½“å¤©å®Œæˆäº†ä¸€ä¸ªé«˜éš¾åº¦ä»»åŠ¡',
    icon: 'ğŸ‚',
    conditionType: 'birthday_task',
    requirement: 1,
    pointsReward: 500,
    honorPoints: 100,
    isHidden: true,
    order: 20,
  },
  {
    dimension: 'surprise',
    category: 'hidden_surprise',
    level: 'legendary',
    name: 'ç”Ÿæ—¥ä¹‹ç‹',
    description: 'åœ¨ç”Ÿæ—¥å½“å¤©å®Œæˆæ‰€æœ‰ä»»åŠ¡',
    icon: 'ğŸ‰',
    conditionType: 'birthday_task',
    requirement: 3,
    pointsReward: 1000,
    honorPoints: 200,
    isHidden: true,
    order: 21,
  },
];

export async function POST(request: NextRequest) {
  try {
    await connectDB();

    const existingCount = await AchievementDefinition.countDocuments();
    
    if (existingCount > 0) {
      return NextResponse.json({
        success: true,
        message: `æˆå°±æ•°æ®å·²å­˜åœ¨ (${existingCount} ä¸ª)ï¼Œå¦‚éœ€é‡æ–°åˆå§‹åŒ–è¯·å…ˆåˆ é™¤ç°æœ‰æ•°æ®`,
        data: { count: existingCount },
      });
    }

    await AchievementDefinition.insertMany(defaultAchievements);

    return NextResponse.json({
      success: true,
      message: `æˆåŠŸåˆå§‹åŒ– ${defaultAchievements.length} ä¸ªæˆå°±`,
      data: { count: defaultAchievements.length },
    });
  } catch (error) {
    console.error('åˆå§‹åŒ–æˆå°±æ•°æ®å¤±è´¥:', error);
    return NextResponse.json(
      { success: false, message: 'åˆå§‹åŒ–å¤±è´¥', error: (error as Error).message },
      { status: 500 }
    );
  }
}

export async function DELETE(request: NextRequest) {
  try {
    await connectDB();

    await AchievementDefinition.deleteMany({});

    return NextResponse.json({
      success: true,
      message: 'å·²æ¸…ç©ºæ‰€æœ‰æˆå°±æ•°æ®',
    });
  } catch (error) {
    console.error('æ¸…ç©ºæˆå°±æ•°æ®å¤±è´¥:', error);
    return NextResponse.json(
      { success: false, message: 'æ¸…ç©ºå¤±è´¥', error: (error as Error).message },
      { status: 500 }
    );
  }
}
